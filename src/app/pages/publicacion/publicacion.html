<div class="publicacion">
    <app-video-fondo></app-video-fondo>
    <div class="container-fluid py-4">
        <div class="m-4 p-2 text-center justify-content-center rounded-pill"
            style="background-color: var(--blanco-opaco); backdrop-filter: blur(5px); width: 10%;">
            <a routerLink="/publicaciones" class="nav-link" style="color: var(--blanco)">Volver</a>
        </div>
        <div class="row justify-content-center">

            <div class="col-12 col-lg-10 d-flex flex-column flex-lg-row shadow-sm p-0"
                style=" background-color: var(--blanco-opaco); backdrop-filter: blur(5px); border-radius: 15px;">

                @if(publicacion()?.imagenPublicacion) {
                <div class="col-12 col-lg-7 d-flex align-items-center justify-content-center p-0"
                    style="min-height: 400px;">
                    <img [src]="publicacion()?.imagenPublicacion" class="img-fluid"
                        style="object-fit: contain; max-height: 85vh; width: 100%; height: 100%;">
                </div>
                } @else{
                <div class="col-12 col-lg-7 d-flex align-items-center justify-content-center p-0"
                    style=" min-height: 400px; background-color: var(--gris-oscuro); border-radius: 10px;">

                    <div class="d-flex align-items-start gap-2 m-4 w-100 p-4"
                        style="background-color: var(--blanco-opaco); backdrop-filter: blur(5px); border-radius: 10px;">
                        <img [src]="publicacion()?.user?.imagenPerfil" class="rounded-circle flex-shrink-0"
                            style="width: 35px; height: 35px;">
                        <div class="d-flex flex-column  " style="min-width: 0; flex: 1;">
                            <strong class="text-white">{{ publicacion()?.user?.name }}</strong>
                            <p class="mb-0 text-white">{{publicacion()?.titulo}}</p>
                            <p class="mb-0"
                                style="color: var(--gris-medio); word-wrap: break-word; overflow-wrap: break-word;">
                                {{ publicacion()?.contenido }}
                            </p>
                        </div>
                    </div>
                </div>
                }


                <div class="text-white d-flex flex-column justify-content-between p-0 col-12 col-lg-5 "
                    style="min-height: 500px; ">

                    <div class="d-flex align-items-center justify-content-between p-3 flex-shrink-0 border-bottom"
                        style="border-color: rgba(255,255,255,0.1) !important;">
                        <div class="d-flex align-items-center gap-2">
                            <img [src]="publicacion()?.user?.imagenPerfil" class="rounded-circle"
                                style="width: 40px; height: 40px; object-fit: cover;">
                            <strong>{{ publicacion()?.user?.name }}</strong>
                        </div>

                        @if(publicacion()?.user?._id === currentUser()._id) {
                        <button class="btn btn-dark p-0" (click)="eliminarPublicacion()">
                            <i class="bi bi-three-dots-vertical text-white"></i>
                        </button>
                        }
                    </div>

                    <div class=" d-flex flex-column justify-content-between h-100">

                        @if(publicacion()?.imagenPublicacion && publicacion()?.contenido) {
                        <div class="p-4 flex-shrink-0 border-bottom"
                            style="border-color: rgba(255,255,255,0.1) !important; max-height: 25vh; overflow-y: auto;">
                            <div class="d-flex align-items-start gap-2">
                                <img [src]="publicacion()?.user?.imagenPerfil" class="rounded-circle flex-shrink-0"
                                    style="width: 32px; height: 32px;">
                                <div style="min-width: 0; flex: 1;">
                                    <strong class="text-white d-block mb-1">{{ publicacion()?.user?.name }}</strong>
                                    <p class="mb-0 text-white">{{publicacion()?.titulo}}</p>
                                    <p class="mb-0"
                                        style="color: var(--gris-medio); word-wrap: break-word; overflow-wrap: break-word; line-height: 1.5;">
                                        {{ publicacion()?.contenido }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        }
                        <div class="flex-grow-1 d-flex flex-column overflow-auto">
                            <app-comentarios [publicacionId]="publicacion()?._id || ''" [currentUser]="currentUser()">
                            </app-comentarios>
                        </div>
                    </div>

                    <div class="p-3 flex-shrink-0 border-top" style="border-color: rgba(255,255,255,0.1) !important;">
                        <div class="interaction-btns d-flex justify-content-between">
                            <div class="toggle-likes">
                                <button (click)="toggleLike()" class="btn p-0 bg-transparent border-0">
                                    <img [src]="hasLiked() ? 'assets/img/me-gusta-activado.png' : 'assets/img/me-gusta-desactivado.png'"
                                        style="width: 28px; height: 28px;">
                                </button>
        
                                <div class="fw-semibold mt-2">
                                    {{ publicacion()?.likes?.length }} Me gusta
                                </div>

                            </div>

                            @if(publicacion()?.user?._id === currentUser()._id || currentUser().perfil === 'administrador'){

                                <button (click)="eliminarPublicacion()" class="btn rounded-pill">
                                    <img src="assets/img/eliminar.png" alt="" style="width: 20px; height: 20px;">
                                </button>
                            }
                            
                        </div>    

                        <div class="text-secondary small">
                            {{ publicacion()?.fechaPublicacion ?? '' | timeAgo }}
                        </div>

                    </div>

                </div>

            </div>

        </div>
    </div>

</div>